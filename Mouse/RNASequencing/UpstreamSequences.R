sequencenames <- c("Bbs7RefExon9bis8", "RefBbs7Ex9toEx8mitDel", "BFMIfront", "B6front")
mdata <- c("GATGGAGGTGACGCTTTCAGACAGCATCTAGAGTAAATGTAAAGTCCACTTTGCTAGCATTGAAACATGTCAAAGACATGTTAAAACAAGCCACAAAACTTTGCTTCTTGTCTCCAGATAGTCAAAACATATTTAGTGTATGTTCATCATGTGCAGACACTGAGGAAAACCTGAATGAATGCTAGAAAATTCCAGCATTTTTAAATATAAGAAAGAAGATTCAAAATAGCTAGTATATTTGTGACAAAACTACATAAAGAAGAGAGGTTTGGTAAATTATATAAACAAAACAGCTAGTAAATTTAGTCTGTAAATCTCTTCAGAGGATTCTTTTTCTCTAATGAAAAAAAAACTATGCTTTCACTGCATAATCTTAAGTTAACGTCTAGAACTCTTATCATAGTCTCATGGAAGTTGTACATAATATTTTAAAGCCATGGCATTTAAAAATCATACCCAGAGCTGGAGAGATGGTTCTGCGGTTAAGAGCGCCCGCTGCTTCTCCAGAGGTCCTGAGTTCAATCCCCAGCAACCACATGGTGGCTCACAAACATCTACAGTGAGTTCTGATGCCCTCTTCTGGCATGCAGGCATACATGCAGATAGAGCACTCACATAAAAGAAATAAGTCTTAGCCGGGCGATGGTGGCACATGCCTTTAATCCCAGCACTCGGGAGGCAGAGGCAGGCAGATTTCTGAGTTCGAGGTCAGCCTGGTCTACAAAGTGAGTGCCAGGACAGTCAGGGCTACACAGAGAAACCCTGTCTCGAAAAACCAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGAAAGAAAGAAAGAAAGAAATCTTAAAAAGAAACATACCCATTGACTCTAAATACCAGGAAAAATTTATATACAAAATCATTGACATTGAAAGTAAGAAACATCAGTTAGAATAACTGAATGCAAGAGAAATAAATGCTACATTGTTCTTTTTCCTCCTTGAACTTTAATTTTCATTTGCAGTGTGTGGGCATGCACACTCCAGTGTGAGTGTGGAGTCAGACAACCTTGAGGAGCTGTCCCTCCTGTTCCACCTTACATGGCTTTGGGGACTGAAAGCAGTCTGCCAGGCTTGTGTGGCACCTCTACACACTAAACCATCTGGCCAGATCTACTGCTTTTAAAAGTCAACATTACTTCTCTCTCTCTCTCTCTCTCTCTCTCATTTGTGCATGTGTACACATACATAGTGTGTATCAACTTTTATTTTCATTGCACTTTCCCCATATATTTTCATTTTAATGTAATATACTCATACATTTTAATATAATTAGATAAAATTCCTTTAACATGGTTTTATATTTATACATGTTTGGTAGGTGAGGTAAGTACACATGATTGCACCCAAAAAAGCATGAAGCCTCAGAGCATCTCAGAGCCAGGGTTACAGGCTGTTGTGAGCCATCGACATGCATCCAGGGAATAAAGTGTAGGTCCTCTGCAAGAACAGTACCAGGAATCTGTCAGCGGGAACACCGTGACCCTACTCCTCTCTCCTAAGAACCAAAGCCACACTGACTGTCTTTCTAAAGCAGTCCGCCCTCTCAGACCTCAGCACAGGAATCAAAAGCAGTGCTAGTAACTACAGTCTGCGAGACAAAACACTCTATAGCCACAACAAGAATTGAAATAAGCCAGACAAAGTACACATGATCTCATTCATATGCAGAACGCCCTCACCTCACGGGGGCTAAGGACAGAATGGCGGGCGCTGCAGTTGTTGAGGAGTAGGGAAGGGATGAGTACGGAAAAGCTGGCTAAGGAGCATCAACATAGTTGCGTATATATGAAGTTCAGACCGTTGCTTTAGTTTTCCTTGAAATTCTGATGGTGACTCATGGCACAGAAAGGAGGAGTGCTTGCCACTGTATAGGGCGACCACAGGTGACAATTATCTAGCACAGGTTTCAAAGGGCTACAAGAAACCATCTTGAGCATTTTCACCCAAGAACTATGTCTACCCTATGTAAACAGTATCCTCAGGGACCACAGGATAACTCCCTGAGTACTGATGCTTGCAGCCAAACTGAGACCTGAGTTTGATTCCTGGGACCCACATGGTGAAACAGGAGAACCAACACCCGGAAGTTATCCTCTGACCTCCGCATGTGTGCCGTGGCGTGCACTTACATACAACATACACACAAATACCACCCCACAAACATTAATATATAAATTTATAAATAAACAATTTAAAACATCTAAAGGTAAAATATTTGGTACCATTATATACTACCATTCATATATAGGTTTTGCTTTTATGTGTCAGAAAAATAAATTAGTAAAAAAAGGTAAAAATTCCATGGTTGCCAGAATGCTTGTCTATATTGATTCTATACCTTTTCATTACATTTAAAATTTCTGAACTAGAATGACTTTACCTAGTATTTCTTCTTTTCTAAGAAAACAGGTCCTTAAGTGTCTACATGCGAGACTATTATTAGGAAGTGCCTGCTTCAAGGTAGTTTCTAAGGAATTCTAATGGTATGGCCTACATGTCTACACTCTTATTACCTTAAAACAAAAATCTCATCAATGAAACTGAAACATATGTTTCCCCTATACTGTGTTGTTATGATTTATAGAAGCTAGAATAAAATATTTAATACCTAATAAATTTAAAATTATATTTAAGAGTGATAATGAAAAAGGAATTTATTTTGTAGCTTATGGGTAATACTCTGTGAGTAAACACGAGATTTTGATAGAGCTCTGAGGGTACTGGTTAGTTCATATTGTTGTTCCACCTATAGGGTTGCAGACCCCTTCAGCTCTTGGGTAATTTCTCTAGCTCCTCCACTGGGGGCCCTGTGATCCATCCAATAGCTGACTGTGAGCATCCACTTATATGTTTGCCAGGCCGCGGCATAGTCTCACAAGAGACAGCTCTATCTGGGTCCTTTCAGCAACATCTTGCTGGTGTGTGCAATGGTGAATGGGAACATTTTACAAGTATTTATTTATTTGTCCTGCGGGCCAGACCTAGATCCTTGGGTACTTTAGGCAAGTGTTTACCAGCGAGCAATGTCCTGGCCCTCTCTGATTCTGCTTTGGGACAGAACAGAGTCTCATTAAAGTTGATTACTCTTCCAGGCAGGCCTGGAACTCCTCATCCTTCTGCCTCAGCCTCTTGTTGGGATTTAGAGGCCTCACCATCAGATTGGGATAGAATAACAACATTTTGTTTTTTAAAAATATATCGTGCTATATTTTTAATTTACCAAAATTCAAACTATCATCCATCTCTATAATAACTAGCCAACAGTAAGTGTATAGTCTCTGTTTTGCTTTGTTTGTTCTGGTCTACAGTACTGGGGCAGAAGCAGGACTTCATACACGCCAGGCAAGTCCTCCACGCTGAGCTACCACTCCAGTCCCCACACAAATCTTTCTAAATCAACTTACCTGATCAAATCGTAGCACAGGTTCATTTGCATTTTCAA", 
           "GATGGAGGTGACGCTTTCAGACAGCATCTAGAGTAAATGTAAAGTCCACTTTGCTAGCATTGAAACATGTCAAAGACATGTTAAAACAAGCCACAAAACTTTGCTTCTTGTCTCCAGATAGTCAAAACATATTTAGTGTATGTTCATCATGTGCAGACACTGAGGAAAACCTGAATGAATGCTAGAAAATTCCAGCATTTTTAAATATAAGAAAGAAGATTCAAAATAGCTAGTATATTTGTGACAAAACTACATAAAGAAGAGAGGTTTGGTAAATTATATAAACAAAACNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNGCACAGAAAGGAGGAGTGCTTGCCACTGTATAGGGCGACCACAGGTGACAATTATCTAGCACAGGTTTCAAAGGGCTACAAGAAACCATCTTGAGCATTTTCACCCAAGAACTATGTCTACCCTATGTAAACAGTATCCTCAGGGACCACAGGATAACTCCCTGAGTACTGATGCTTGCAGCCAAACTGAGACCTGAGTTTGATTCCTGGGACCCACATGGTGAAACAGGAGAACCAACACCCGGAAGTTATCCTCTGACCTCCGCATGTGTGCCGTGGCGTGCACTTACATACAACATACACACAAATACCACCCCACAAACATTAATATATAAATTTATAAATAAACAATTTAAAACATCTAAAGGTAAAATATTTGGTACCATTATATACTACCATTCATATATAGGTTTTGCTTTTATGTGTCAGAAAAATAAATTAGTAAAAAAAGGTAAAAATTCCATGGTTGCCAGAATGCTTGTCTATATTGATTCTATACCTTTTCATTACATTTAAAATTTCTGAACTAGAATGACTTTACCTAGTATTTCTTCTTTTCTAAGAAAACAGGTCCTTAAGTGTCTACATGCGAGACTATTATTAGGAAGTGCCTGCTTCAAGGTAGTTTCTAAGGAATTCTAATGGTATGGCCTACATGTCTACACTCTTATTACCTTAAAACAAAAATCTCATCAATGAAACTGAAACATATGTTTCCCCTATACTGTGTTGTTATGATTTATAGAAGCTAGAATAAAATATTTAATACCTAATAAATTTAAAATTATATTTAAGAGTGATAATGAAAAAGGAATTTATTTTGTAGCTTATGGGTAATACTCTGTGAGTAAACACGAGATTTTGATAGAGCTCTGAGGGTACTGGTTAGTTCATATTGTTGTTCCACCTATAGGGTTGCAGACCCCTTCAGCTCTTGGGTAATTTCTCTAGCTCCTCCACTGGGGGCCCTGTGATCCATCCAATAGCTGACTGTGAGCATCCACTTATATGTTTGCCAGGCCGCGGCATAGTCTCACAAGAGACAGCTCTATCTGGGTCCTTTCAGCAACATCTTGCTGGTGTGTGCAATGGTGAATGGGAACATTTTACAAGTATTTATTTATTTGTCCTGCGGGCCAGACCTAGATCCTTGGGTACTTTAGGCAAGTGTTTACCAGCGAGCAATGTCCTGGCCCTCTCTGATTCTGCTTTGGGACAGAACAGAGTCTCATTAAAGTTGATTACTCTTCCAGGCAGGCCTGGAACTCCTCATCCTTCTGCCTCAGCCTCTTGTTGGGATTTAGAGGCCTCACCATCAGATTGGGATAGAATAACAACATTTTGTTTTTTAAAAATATATCGTGCTATATTTTTAATTTACCAAAATTCAAACTATCATCCATCTCTATAATAACTAGCCAACAGTAAGTGTATAGTCTCTGTTTTGCTTTGTTTGTTCTGGTCTACAGTACTGGGGCAGAAGCAGGACTTCATACACGCCAGGCAAGTCCTCCACGCTGAGCTACCACTCCAGTCCCCACACAAATCTTTCTAAATCAACTTACCTGATCAAATCGTAGCACAGGTTCATTTGCATTTTCAA",
           "TTTCATTCAGAGTTGAAGGAACATGTATGCGCGAAGCTCCNNNNNNNNNNNAAGCAGAGCGCTGGCCCAGCGGCCCAGAGCTGGGAGGCAGAGAATGCGCCCCGGTTGCCTTGGAAACCGGCCAGCGTCTGAGGACCGTTCCCTCCGCCCCCCTTTCTTGGTGCAGCTCCCCGGGAGAGGGCGGGGCTTCACAGTGAGCTAAGATGGGTCACGTGTCGAGCCGGCGTTGCTGGGCGCCGCTGCCCTGACGCAGGCCGGCTCGTCGGTCTAGTGGTGGGCTCTCCGAGGGAAGGCTTCCACAGCGGGTCCCGCCTCTCCGTGCGGCCGC",
           "TTTCATTCAGAGCTGAAGGAACATGCATGAGCGAAGCTCCAGCGAAGCTCCAAGCAGATCGCTGGCCCAGCGGCCCAGAGCTGGGAGGCAGAGAATGCGCCCCGGTTGCCTTGGAAACCGGCCAGCGTCTGAGGACCGTTCCCTCCGCCCCCCTTTCCTGGTGCAGCTCCCCGGGAGAGGGCGGGGCTTCACAGTGAGCTAAGATGGGTCACGTGTCGAGCCCGCGTTGCTGGGCGCCGCTGCCCTGACGCAGGCCGGCTCGTCAGTCTAGTGGTGGGCTCTCCGAGGGAAGGCTTCCACAGCGGGTCCCGCCTCTCCGTGCGGCCGC")

names(mdata) <- sequencenames

# copyright (c) 2014-2020 - Brockmann group - HU Berlin, Danny Arends
# last modified Feb, 2015
# first written Feb, 2015

library(MotifDb)
library(seqLogo)
library(motifStack)
library(Biostrings)
library(GenomicFeatures)

TFBSjasparALL <- query(MotifDb, "Mmusculus")


output <- matrix(NA,  length(names(TFBSjasparALL)), length(mdata), dimnames=list(names(TFBSjasparALL), sequencenames))

plot(c(1, 3470), c(0, 3), t = 'n', xlab="basepair",ylab = "Sequence", yaxt='n')
lines(c(1, nchar(mdata[1])), c(1, 1), lwd = 2)
lines(c(1, nchar(mdata[3])), c(2, 2), lwd = 2)

cols <- c("gray", "gray", "orange", "gray")

found <- 10
for(tfbs in 1:length(TFBSjasparALL)){
  # seqLogo(TFBSjasparALL[[tfbs]])
  TFBSjaspar <- round(100 * TFBSjasparALL[[tfbs]])
  for(gene in sequencenames){
    hits <- matchPWM(TFBSjaspar, as.character(mdata[gene]), "90%")
    output[names(TFBSjasparALL)[tfbs], gene] <- length(hits)
    if( length(hits) > 0){
      for(hit in 1:length(hits)){
        tfbs.name   <- gsub("Mmusculus-","",names(TFBSjasparALL)[tfbs])
        tfbs.seq    <- as.character(unlist(hits))
        tfbs.start  <- hits@ranges@start[hit]
        tfbs.width  <- hits@ranges@width[hit]
        seqid <- which(sequencenames == gene)
        y <- (0.25 + 0.5 * seqid) + sign((seqid %% 2) - 0.5) / (1.5 + found/170)
        cat(seqid, found, y,"\n")
        lines(c(tfbs.start - 5, tfbs.start + tfbs.width + 5), c(y, y), lwd = 2, col = cols[seqid])
      }
      found <- found + 1
    }
  }
}

setwd("E:/Mouse/RNA/Sequencing/Reciprocal Cross B6 BFMI by MPI")

DEL <- which(!unlist(strsplit(mdata[2],"")) == unlist(strsplit(mdata[1],""))); points(DEL,rep(1,length(DEL)), pch=19, col='red', cex=0.5)
DEL <- which(!unlist(strsplit(mdata[3],"")) == unlist(strsplit(mdata[4],""))); points(DEL,rep(2,length(DEL)), pch=19, col='red', cex=0.5)

diff34 <- output[apply(output[,c("BFMIfront","B6front")],1,sum) > 0,]
diff12 <- output[apply(output[,c("Bbs7RefExon9bis8","RefBbs7Ex9toEx8mitDel")],1,sum) > 0,]

write.table(diff34, "BFMI_B6_frontSequence.txt", sep = "\t", quote = FALSE)
write.table(diff12, "BFMI_B6_Ex9toEx8_Sequence.txt", sep = "\t", quote = FALSE)
